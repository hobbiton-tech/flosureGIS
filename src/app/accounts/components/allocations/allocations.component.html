<div style="margin: 20px;">
  <div style="margin-bottom: 20px; background: #fff;">
    <nz-page-header>
      <nz-page-header-title>Allocations</nz-page-header-title>
<!--      <nz-page-header-content>-->
<!--        <nz-descriptions [nzColumn]="3">-->
<!--          <nz-descriptions-item-->
<!--            nzTitle="Total Payment Plans"-->
<!--            [nzSpan]="1"-->
<!--          >{{ paymentPlansCount }}</nz-descriptions-item-->
<!--          >-->
<!--        </nz-descriptions>-->
<!--      </nz-page-header-content>-->
      <nz-page-header-extra>
        <div nz-col nzSpan="12">

          <button nz-button nz-dropdown nzType="primary" [nzDropdownMenu]="menu" >{{selectedIntermediaryType}}</button>
          <nz-dropdown-menu #menu="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item *ngFor="let int of typeOfIntermediaries" (click)="selectIntermediaryType(int)">{{int}}</li>
            </ul>
          </nz-dropdown-menu>
        </div>
      </nz-page-header-extra>
    </nz-page-header>
  </div>


  <nz-card [nzBordered]="false" style="margin-top: 20px;">
    <nz-card [nzBordered]="false" nzTitle="Receipts">
      <div style="margin-bottom: 10px;">
        <div nz-row [nzGutter]="24">
          <div nz-col nzSpan="12">
            <div style="width: 75%;">
              <nz-input-group [nzSuffix]="suffixIconSearch">
                <input
                  type="text"
                  nz-input
                  placeholder="Search by Receipt Number, Intermediary ID"
                />
              </nz-input-group>
              <ng-template #suffixIconSearch>
                <i nz-icon nzType="search"></i>
              </ng-template>
            </div>
          </div>
          <div nz-col nzSpan="12">
            <div style="width: 75%;">
              <nz-select [(ngModel)]="selectedInt" (ngModelChange)="selectInt($event)" nzAllowClear nzPlaceHolder="Select a person" nzShowSearch>
                <div *ngIf="this.selectedIntermediaryType === 'Broker'">
                  <nz-option *ngFor="let broker of brokers" [nzLabel]="broker.companyName" [nzValue]="broker.id"></nz-option>
                </div>
                <div *ngIf="this.selectedIntermediaryType === 'Agent'">
                  <nz-option *ngFor="let agent of agents" [nzLabel]="agent.companyName" [nzValue]="agent.id"></nz-option>
                </div>
                <div *ngIf="this.selectedIntermediaryType === 'SalesRepresentative'">
                  <nz-option *ngFor="let salesRep of salesReps" [nzValue]="salesRep.id" [nzLabel]="salesRep.contactFirstName + ' ' + salesRep.contactLastName"></nz-option>
                </div>
              </nz-select>
            </div>
          </div>
        </div>
      </div>

      <nz-table
        #receiptsTable
        [nzData]="allocationReceiptsList"
        [nzSize]="'small'"
        [nzBordered]="true"
        style="background-color: white;"
      >

        <thead>
        <tr>
          <th>Receipt Number</th>
          <th>Intermediary Name</th>
          <th>Receipted Amount</th>
          <th>Allocated Amount</th>
          <th>Remaining Amount</th>
          <th>Status</th>
        </tr>
        </thead>

        <tbody>
        <tr
          style="cursor: pointer;"
          *ngFor="let receipt of receiptsTable.data" style="cursor: pointer;"
          [class.selected]="receipt === selectedRole"
          (click)="showAllocationRole(receipt)"
        >
          <td>{{ receipt.receipt_number }}</td>
          <td>{{ receipt.intermediary_name }}</td>
          <td>{{ receipt.amount | number: '1.2-2' }}</td>
          <td>{{ receipt.allocated_amount | number: '1.2-2' }}</td>
          <td>{{ receipt.remaining_amount | number: '1.2-2' }}</td>
          <td>{{ receipt.status }}</td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>

    <nz-card [nzBordered]="false" nzTitle="Policies">
      <div style="margin-bottom: 10px;">
        <div nz-row [nzGutter]="24">
          <div nz-col nzSpan="12">
            <div style="width: 75%;">
              <nz-input-group [nzSuffix]="suffixIconSearch">
                <input
                  type="text"
                  nz-input
                  placeholder="Search by Receipt Number, Intermediary ID"
                />
              </nz-input-group>
              <ng-template #suffixIconSearch>
                <i nz-icon nzType="search"></i>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <nz-table
        #policiesTable
        [nzData]="allocationPoliciesList"
        [nzSize]="'small'"
        [nzBordered]="true"
        style="background-color: white;"
      >

        <thead>
        <tr>
          <th>Policy Number</th>
          <th>Client Name</th>
          <th>Gross Amount</th>
          <th>Net Due Amount</th>
          <th>Settlements</th>
          <th>Balance</th>
          <th>Commission Due</th>
          <th>Status</th>
          <th></th>
        </tr>
        </thead>

        <tbody>
        <tr
          style="cursor: pointer;"
          *ngFor="let policy of policiesTable.data" style="cursor: pointer;"
        >
          <td>{{ policy.policy_number }}</td>
          <td>{{ policy.client_name }}</td>
          <td>{{ policy.gross_amount | number: '1.2-2' }}</td>
          <td>{{ policy.net_amount_due | number: '1.2-2' }}</td>
          <td>{{ policy.settlements | number: '1.2-2' }}</td>
          <td>{{ policy.balance | number: '1.2-2' }}</td>
          <td>{{ policy.commission_due | number: '1.2-2' }}</td>
          <td>{{ policy.status }}</td>
          <td>
            <div
              *ngIf="policy.status !== 'Allocated' "
            >
              <button
                nz-button
                [disabled]="policyTableActive"
                nzType="primary"
                (click)="showAllocationModal(policy)"
              >
                Allocate
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-card>


  <nz-modal [nzWidth]="1000" [(nzVisible)]="isAllocateVisible" nzTitle="Allocate Amount" (nzOnCancel)="handleAllocateCancel()" (nzOnOk)="handleAllocationOk()">
    <nz-card
      style="width: 90%; margin: 0 auto;"
      [nzBordered]="true"
      nzTitle="Allocation Details"
    >
      <form [formGroup]="allocationForm" nz-form>
        <div nz-row>

          <div nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-label [nzSpan]="12" nzFor="policies"
              >Policy</nz-form-label
              >
              <nz-form-control nzSpan="12">
                <input
                  nz-input
                  name="policy"
                  id="policy"
                  formControlName="policy"
                  readonly
                />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-label
                [nzSpan]="8"
                nzFor="amount"
                nzRequired
              >Amount</nz-form-label
              >
              <nz-form-control [nzSpan]="16">
                <input
                  nz-input
                  name="amount"
                  type="number"
                  id="amount"
                  formControlName="amount"
                  [max]="amount"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-control [nzSpan]="12">
              <label  nz-checkbox [(ngModel)]="checked" [ngModelOptions]="{standalone: true}" (ngModelChange)="log($event)">Commission Incl</label>
              </nz-form-control>
            </nz-form-item>

          </div>
        </div>
      </form>
    </nz-card>
  </nz-modal>
</div>
