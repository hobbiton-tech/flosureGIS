<nz-spin nzSize="large" nzTip="Quotation Details Loading...." [nzSpinning]="isQuoteDetailsLoading">
    <nz-spin [nzSize]="'large'" [nzSpinning]="approvingQuote" [nzTip]="'Converting Quote to Policy...'">
        <div style="margin: 15px;">
            <nz-breadcrumb>
                <nz-breadcrumb-item>
                    Quotes
                </nz-breadcrumb-item>
                <nz-breadcrumb-item>
                    Quotes List
                </nz-breadcrumb-item>
                <nz-breadcrumb-item>
                    Quote Details
                </nz-breadcrumb-item>
            </nz-breadcrumb>
            <nz-page-header nzBackIcon [nzTitle]="title">
                <ng-template #title>
                    <div style="display: flex; align-items: center;">
                        <span style="margin-right: 8px;">Quote Number: {{ quote.quoteNumber }}</span>
                        <nz-tag [nzColor]="isQuoteApproved ? 'blue' : 'orange'">
                            {{ isQuoteApproved ? 'Approved' : 'Pending Approval' }}
                        </nz-tag>
                    </div>
                </ng-template>
                <nz-page-header-extra>
                    <button *ngIf="!isQuoteApproved" nz-button nzType="primary" (click)="handleDraftQuotation()">
                        View Draft Quote
                    </button>
                  <ng-container *ngIf="approveQuote === isPresent?.name || admin === isPresent?.name">
                    <button *ngIf="!isQuoteApproved" nz-button nzType="primary" (click)="generateDocuments()">

                      Covert to Policy
                    </button>
                  </ng-container>
                  <ng-container *ngIf="editQuote === isPresent?.name || admin === isPresent?.name">
                    <button *ngIf="!isEditmode && !isQuoteApproved" nz-button nzType="primary"
                        (click)="isEditmode = true">
                        Edit Quote
                    </button>
                  </ng-container>
                    <button *ngIf="isEditmode" nz-button nzType="primary" (click)="isEditmode = false">
                        Save Changes
                    </button>
                </nz-page-header-extra>
            </nz-page-header>
            <!-- Policy Details form starts here -->
            <form nz-form style="margin-top: 20px;" [formGroup]="quoteDetailsForm" novalidate>
                <nz-card nzTitle="Policy Details" style="margin-bottom: 5px;">
                    <div nz-row nzGutter="0">
                        <div nz-col nzSpan="12">
                            <nz-form-item>
                                <nz-form-label nzSpan="7" nzRequired>Client Name</nz-form-label>
                                <nz-form-control nzSpan="17">
                                    <nz-select formControlName="client" nzPlaceHolder="Select or create client"
                                        [nzDisabled]="!isEditmode">
                                        <div *ngFor="let client of clients">
                                            <nz-option [nzValue]="
                                                client.clientType ===
                                                'Individual'
                                                    ? client.firstName +
                                                      ' ' +
                                                      client.lastName
                                                    : client.companyName
                                            " [nzLabel]="
                                                client.clientType ===
                                                'Individual'
                                                    ? client.firstName +
                                                      ' ' +
                                                      client.lastName
                                                    : client.companyName
                                            "></nz-option>
                                        </div>

                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzSpan="7" nzRequired>Currency</nz-form-label>
                                <nz-form-control nzSpan="17">
                                    <nz-select formControlName="currency" nzPlaceHolder="Select currency"
                                        [nzDisabled]="!isEditmode">
                                        <nz-option nzValue="ZMW" nzLabel="ZMW"></nz-option>
                                        <nz-option nzValue="Dollar" nzLabel="Dollar"></nz-option>
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label [nzSpan]="7" nzFor="sourceOfBusiness" nzRequired>Source Of Business
                                </nz-form-label>
                                <nz-form-control nzSpan="17">
                                    <nz-select name="sourceOfBusiness" formControlName="sourceOfBusiness"
                                        [(ngModel)]="selectedSourceOfBusiness" nzAllowClear
                                        nzPlaceHolder="Select source of Business" [nzDisabled]="!isEditmode">
                                        <nz-option *ngFor="
                                            let option of sourceOfBusinessOptions
                                        " [nzValue]="option.value" [nzLabel]="option.label"></nz-option>
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <div *ngIf="selectedSourceOfBusiness === 'broker'">
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7" nzFor="intermediaryName" nzRequired>Broker
                                    </nz-form-label>
                                    <nz-form-control nzSpan="17">
                                        <nz-select name="intermediaryName" formControlName="intermediaryName"
                                            nzAllowClear nzPlaceHolder="Select broker" [nzDisabled]="!isEditmode">
                                            <nz-option *ngFor="let option of brokers" [nzValue]="option.companyName"
                                                [nzLabel]="option.companyName"></nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                            <div *ngIf="selectedSourceOfBusiness === 'agent'">
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7" nzFor="intermediaryName" nzRequired>Agent
                                    </nz-form-label>
                                    <nz-form-control nzSpan="17">
                                        <nz-select name="intermediaryName" formControlName="intermediaryName"
                                            nzAllowClear nzPlaceHolder="Select agent" [nzDisabled]="!isEditmode">
                                            <nz-option *ngFor="let option of agents" [nzValue]="option.companyName"
                                                [nzLabel]="option.companyName">
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                            <div *ngIf="
                                selectedSourceOfBusiness ===
                                'salesRepresentative'
                            ">
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7" nzFor="intermediaryName" nzRequired>Sales Representative
                                    </nz-form-label>
                                    <nz-form-control nzSpan="17">
                                        <nz-select name="intermediaryName" formControlName="intermediaryName"
                                            nzAllowClear nzPlaceHolder="Select Sales Representative"
                                            [nzDisabled]="!isEditmode">
                                            <nz-option *ngFor="
                                                let option of salesRepresentatives
                                            " [nzValue]="
                                                option.contactFirstName +
                                                ' ' +
                                                option.contactLastName
                                            " [nzLabel]="
                                                option.contactFirstName +
                                                ' ' +
                                                option.contactLastName
                                            ">
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                        </div>
                        <div nz-col nzSpan="12">
                            <nz-form-item>
                                <nz-form-label nzRequired nzSpan="7">Start Date</nz-form-label>
                                <nz-form-control nzSpan="17">
                                    <nz-date-picker formControlName="startDate" nzFormat="dd-MM-yyyy"
                                        [nzDisabled]="!isEditmode" (ngModelChange)="
                                        handlePolicyEndDateCalculation()
                                    ">
                                    </nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col nzSpan="12">
                            <nz-form-item>
                                <nz-form-label nzSpan="7" nzRequired>Quarter</nz-form-label>
                                <nz-form-control nzSpan="5">
                                    <nz-select formControlName="quarter" nzPlaceHolder="Select quarter"
                                        [nzDisabled]="!isEditmode" (ngModelChange)="
                                        handlePolicyEndDateCalculation()
                                    ">
                                        <nz-option nzValue="1" nzLabel="1"></nz-option>
                                        <nz-option nzValue="2" nzLabel="2"></nz-option>
                                        <nz-option nzValue="3" nzLabel="3"></nz-option>
                                        <nz-option nzValue="4" nzLabel="4"></nz-option>
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzRequired nzSpan="7">End Date</nz-form-label>
                                <nz-form-control nzSpan="17">
                                    <nz-date-picker formControlName="endDate" nzFormat="dd-MM-yyyy" nzPlaceHolder="End"
                                        nzDisabled="true"></nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </nz-card>
            </form>
            <!-- Policy Details form ends here -->

            <!-- Risk Details starts here -->
            <nz-card nzTitle="Risk Details" style="margin-bottom: 5px;">
                <div nz-row nzGutter="0" style="margin-top: 5px;">
                    <div nz-col>
                        <div *ngIf="isEditmode">
                            <nz-collapse>
                                <nz-collapse-panel nzHeader="Add Risk" [nzActive]="isAddRiskPanelOpen"
                                    (nzActiveChange)="resetForms()">
                                    <div nz-row nzGutter="0" style="margin-bottom: 30px;">
                                        <div nz-col nzSpan="8">
                                        </div>
                                        <div nz-col nzSpan="8"></div>
                                        <div nz-col nzSpan="8">
                                            <nz-form-item>
                                                <button nz-button nzType="primary" (click)="showModal()"
                                                    style="float: right;">
                                                    Import Fleet
                                                </button>
                                            </nz-form-item>
                                        </div>
                                    </div>
                                    <!-- create quote component structure -->
                                    <nz-divider nzText="Vehicle Details" nzOrientation="left">
                                    </nz-divider>

                                    <!-- vehicle details -->
                                    <app-vehicle-details></app-vehicle-details>

                                    <div style="margin-top: 15px;">
                                        <nz-divider nzText="Premium Computation" nzOrientation="left">
                                        </nz-divider>

                                        <!-- premium computation details -->
                                        <app-premium-computation-details></app-premium-computation-details>
                                        <!-- end of premium computation details -->

                                        <nz-divider nzOrientation="left">
                                        </nz-divider>

                                        <div nz-row nzGutter="0">
                                            <div nz-col nzSpan="8">
                                                <!-- TODO => combine premium computation and premium computation details components -->
                                                <!-- premium computation -->
                                                <app-premium-computation></app-premium-computation>
                                                <!-- extensions starts here -->
                                                <app-extensions></app-extensions>
                                                <!-- </div> -->

                                                <!-- Discount Starts here -->
                                                <app-discounts></app-discounts>
                                                <!-- Discount Ends here -->
                                            </div>

                                            <div nz-col nzSpan="8">
                                                <div nz-col nzSpan="24">
                                                    <nz-card>
                                                        <nz-divider nzText="Extensions" nzOrientation="left">
                                                        </nz-divider>

                                                        <!-- extensions view -->
                                                        <app-extensions-view></app-extensions-view>

                                                    </nz-card>

                                                    <div nz-col nzSpan="24">
                                                        <div style="
                                                                            margin-top: 5px;
                                                                        ">
                                                            <nz-card>
                                                                <nz-divider nzText="Discount" nzOrientation="left">
                                                                </nz-divider>
                                                                <!-- discounts view -->
                                                                <app-discounts-view></app-discounts-view>
                                                            </nz-card>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div nz-col nzSpan="8">
                                                <div nz-col nzSpan="20" style="float: right;">
                                                    <nz-card>
                                                        <!-- totals view -->
                                                        <app-totals-view></app-totals-view>
                                                    </nz-card>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <nz-divider nzText="Schedule" nzOrientation="left"></nz-divider>

                                    <div nz-row nzGutter="10">
                                        <div nz-col nzSpan="12">
                                            <nz-card>
                                                <!-- limits of liability -->
                                                <app-limits-of-liability></app-limits-of-liability>
                                            </nz-card>

                                        </div>
                                        <div nz-col nzSpan="12">
                                            <nz-card>
                                                <nz-divider nzText="Excesses" nzOrientation="left"></nz-divider>
                                                <!-- excesses -->
                                                <app-excesses></app-excesses>
                                            </nz-card>
                                        </div>
                                    </div>

                                    <div style="text-align: center; margin-top: 10px; margin-bottom: 10px;">
                                        <button nz-button nzType="primary" (click)="addRisk()">
                                            Add Risk
                                        </button>
                                        <button nz-button nzType="default">
                                            Reset Form
                                        </button>
                                    </div>
                                    <!-- //////// -->
                                </nz-collapse-panel>
                            </nz-collapse>
                        </div>
                    </div>
                </div>

                <!-- Risks Table Search bar and Table details start here -->
                <div style="margin-bottom: 20px; margin-top: 20px; width: 20%;">
                    <nz-input-group [nzSuffix]="suffixIconSearch">
                        <input type="text" nz-input placeholder="Search by client, quotation number, agent" />
                    </nz-input-group>
                    <ng-template #suffixIconSearch>
                        <i nz-icon nzType="search"></i>
                    </ng-template>

                </div>
                <nz-table #risksTable [nzData]="risks" [nzSize]="'small'" [nzBordered]="true" id="risksTable">
                    <thead>
                        <tr>
                            <th>Insurance Type</th>
                            <th>Product Type</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Sum Insured</th>
                            <th>Premium</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let risk of risksTable.data; let i = index" style="cursor: pointer;">
                            <td>{{ risk.insuranceType }}</td>
                            <td>{{ risk.productType }}</td>
                            <td>{{ risk.riskStartDate | date}}</td>
                            <td>{{ risk.riskEndDate | date}}</td>
                            <td>{{ risk.sumInsured | number }}</td>
                            <td>{{ risk.netPremium | number: '1.2-2' }}</td>
                            <td>
                                <button nz-button nzType="primary" nzSize="small" (click)="viewRiskDetails(risk)">
                                    View
                                </button>
                                <nz-divider nzType="vertical" *ngIf="!isQuoteApproved"></nz-divider>
                              <ng-container *ngIf="deleteRisk === isPresent?.name || admin === isPresent?.name">
                                <button nz-button nzType="danger" nzSize="small" nz-popconfirm nzTitle="Delete Risk?"
                                    (nzOnConfirm)="removeRisk(risk.regNumber)" *ngIf="!isQuoteApproved">
                                    Delete
                                </button>
                              </ng-container>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
                <div *ngIf="!isTabletemplate">
                    <nz-table [nzData]="risks" [nzSize]="'small'" [nzBordered]="true" id="risksTemplateTable">
                        <thead>
                            <tr>
                                <th>insuranceType</th>
                                <th>regNumber</th>
                                <th>vehicleMake</th>
                                <th>vehicleModel</th>
                                <th>engineNumber</th>
                                <th>chassisNumber</th>
                                <th>color</th>
                                <th>productType</th>
                                <th>SumInsured</th>
                                <th>netPremium</th>
                            </tr>
                        </thead>
                    </nz-table>
                </div>

            </nz-card>
            <!-- Risk Details ends here -->

            <!-- view risk modal -->
            <app-view-risk [isViewRiskModalVisible]="viewRiskModalVisible"
                (closeViewRiskModal)="viewRiskModalVisible=false" [riskData]="selectedRisk"
                [isQuoteApproved]="isQuoteApproved">
            </app-view-risk>

            <!-- Quote PDFs Modal-->
            <nz-modal [(nzVisible)]="isViewQuotePDFVisible" nzTitle="A Plus General Insurance"
                (nzOnCancel)="isViewQuotePDFVisible = false" (nzOnOk)="isViewQuotePDFVisible = false" nzWidth="800">
                <nz-card style="width: 100%;" [nzBordered]="true" nzTitle="Quote Document" [nzExtra]="pdfQuoteActions">
                    <app-quote-document [quoteNumber]="quoteNumber" [clientName]="quoteData.client"
                        [dateCreated]="quoteData.dateCreated" [basicPremium]="basicPremium"
                        [loadingAmount]="premiumLoadingTotal" [discountAmount]="premiumDiscount"
                        [totalAmount]="netPremium" [premiumLevy]="basicPremiumLevy" [numberOfRisks]="numberOfRisks">
                    </app-quote-document>
                </nz-card>
                <ng-template #pdfQuoteActions>
                    <div style="display: flex;">
                        <div style="margin-right: 8px;">
                            <button nz-button nzSize="medium" nzType="primary">
                                Print
                            </button>
                        </div>
                        <div>
                            <button nz-button nzSize="medium" nzType="primary">
                                Email
                            </button>
                        </div>
                    </div>
                </ng-template>
            </nz-modal>

            <nz-modal [(nzVisible)]="isViewDraftQuotePDFVisible" (nzOnCancel)="isViewDraftQuotePDFVisible = false"
                (nzOnOk)="isViewDraftQuotePDFVisible = false" nzWidth="800">
                <nz-card style="width: 100%;" [nzBordered]="true" nzTitle="Motor Quote Document">
                    <app-draft-quote-document [quoteNumber]="quoteNumber" [clientName]="quoteData.client"
                        [dateCreated]="quoteData.dateCreated" [basicPremium]="quoteBasicPremium"
                        [loadingAmount]="premiumLoadingTotal" [discountAmount]="quoteDiscountTotal"
                        [totalAmount]="quoteNetPremium" [premiumLevy]="quoteLevy" [numberOfRisks]="numberOfRisks"
                        [risks]="quoteData.risks" [quoteData]="quoteData" [totalSumInsured]="quoteSumInsured"
                        [totalBasicPremium]="quoteBasicPremium" [totalLevy]="quoteLevy"
                        [totalNetPremium]="quoteNetPremium" [excessList]="excessList"
                        [limitsOfLiabilities]="limitsOfLiabilities">
                    </app-draft-quote-document>
                </nz-card>
                <ng-template #pdfQuoteActions>
                    <div style="display: flex;">
                        <div style="margin-right: 8px;">
                            <button nz-button nzSize="medium" nzType="primary">
                                Print
                            </button>
                        </div>
                        <div>
                            <button nz-button nzSize="medium" nzType="primary">
                                Email
                            </button>
                        </div>
                    </div>
                </ng-template>
            </nz-modal>

            <nz-modal [(nzVisible)]="isViewFireDraftQuotePDFVisible"
                (nzOnCancel)="isViewFireDraftQuotePDFVisible = false" (nzOnOk)="isViewFireDraftQuotePDFVisible = false"
                nzWidth="800">
                <nz-card style="width: 100%;" [nzBordered]="true" nzTitle="Fire Quote Document">
                    <app-fire-draft-quote-document [quoteNumber]="quoteNumber" [clientName]="quoteData.client"
                        [dateCreated]="quoteData.dateCreated" [basicPremium]="quoteBasicPremium"
                        [loadingAmount]="premiumLoadingTotal" [discountAmount]="quoteDiscountTotal"
                        [totalAmount]="quoteNetPremium" [premiumLevy]="quoteLevy" [numberOfRisks]="numberOfRisks"
                        [risks]="quoteData.risks" [quoteData]="quoteData" [totalSumInsured]="quoteSumInsured"
                        [totalBasicPremium]="quoteBasicPremium" [totalLevy]="quoteLevy"
                        [totalNetPremium]="quoteNetPremium" [excessList]="excessList"
                        [limitsOfLiabilities]="limitsOfLiabilities">
                    </app-fire-draft-quote-document>
                </nz-card>
                <ng-template #pdfQuoteActions>
                    <div style="display: flex;">
                        <div style="margin-right: 8px;">
                            <button nz-button nzSize="medium" nzType="primary">
                                Print
                            </button>
                        </div>
                        <div>
                            <button nz-button nzSize="medium" nzType="primary">
                                Email
                            </button>
                        </div>
                    </div>
                </ng-template>
            </nz-modal>
        </div>
    </nz-spin>

    <nz-modal [(nzVisible)]="isPlanVisible" [nzTitle]="modalTitle" [nzContent]="modalContent" [nzFooter]="modalFooter"
        [nzWidth]="1000" (nzOnCancel)="handleReceiptCancel()">
        <ng-template #modalTitle>
            Payment Plan
        </ng-template>

        <ng-template #modalContent>
            <div nz-row nzGutter="0">
                <div nz-col [nzSpan]="12">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="9" nzFor="paymentPlan">Payment Plan</nz-form-label>
                        <nz-form-control nzSpan="15">
                            <nz-select style="width: 200px;" name="paymentPlan" nzShowSearch nzAllowClear
                                [(ngModel)]="selectedPlan" nzPlaceHolder="Choose Payment Plan">
                                <div *ngIf="
                                    getInsuranceType === 'Comprehensive';
                                    else notShow
                                ">
                                    <nz-option [nzValue]="'plan'" [nzLabel]="'Payment Plan'">
                                    </nz-option>
                                    <nz-option [nzValue]="'fully'" [nzLabel]="'Full Payment'">
                                    </nz-option>
                                </div>


                                <ng-template #notShow>
                                    <nz-option [nzValue]="'fully'" [nzLabel]="'Full Payment'">
                                    </nz-option>
                                </ng-template>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row nzGutter="0" *ngIf="selectedPlan === 'fully'">
                <form [formGroup]="receiptForm" nz-form>
                    <div nz-row>
                        <div nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="8" nzFor="receivedFrom">Received From</nz-form-label>
                                <nz-form-control [nzSpan]="16" nzErrorTip="Please enter Depositor's name!">
                                    <input nz-input formControlName="receivedFrom" name="receivedFrom" type="text"
                                        id="receivedFrom" nzRequired placeholder="Received From" />
                                    <span class="text-danger" *ngIf="

                                        (receiptFormControl.receivedFrom
                                            .touched ||
                                            submitted) &&
                                        receiptFormControl.receivedFrom.errors
                                            ?.required
                                    ">
                                        Please enter Depositor's name!
                                    </span>
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="8" nzFor="sumInDigits" nzRequired>Amount</nz-form-label>
                                <nz-form-control [nzSpan]="16">
                                    <input nz-input name="sumInDigits" type="number" id="sumInDigits"
                                        formControlName="sumInDigits" placeholder="{{ amount }}" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                    <div nz-row>
                        <div nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="6" nzFor="receiptType" nzRequired>Receipt Type</nz-form-label>
                                <nz-form-control nzSpan="18">
                                    <nz-select name="receiptType" formControlName="receiptType" nzAllowClear
                                        nzPlaceHolder="Choose">
                                        <nz-option *ngFor="
                                            let option of optionTypeOfReceiptList
                                        " [nzValue]="option.value" [nzLabel]="option.label"></nz-option>
                                    </nz-select>
                                    <span class="text-danger" *ngIf="

                                        (receiptFormControl.receiptType
                                            .touched ||
                                            submitted) &&
                                        receiptFormControl.receiptType.errors
                                            ?.required
                                    ">
                                        Please choose receipt type!
                                    </span>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="8" nzFor="paymentMethod" nzRequired>Payment Method
                                </nz-form-label>
                                <nz-form-control [nzSpan]="16">
                                    <nz-select name="paymentMethod" formControlName="paymentMethod" nzAllowClear
                                        nzPlaceHolder="Choose payment Method" (ngModelChange)="
                                        paymentMethodChange($event)
                                    ">
                                        <nz-option *ngFor="let method of paymentMethodList" [nzValue]="method.value"
                                            [nzLabel]="method.label"></nz-option>
                                    </nz-select>
                                    <span class="text-danger" *ngIf="

                                        (receiptFormControl.paymentMethod
                                            .touched ||
                                            submitted) &&
                                        receiptFormControl.paymentMethod.errors
                                            ?.required
                                    ">
                                        Please choose payment method!
                                    </span>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                    <div nz-row>
                        <div nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="6" nzFor="narration" nzRequired>Narration</nz-form-label>
                                <nz-form-control nzSpan="18">
                                    <textarea formControlName="narration" nz-input rows="2"
                                        placeholder="Write Your Narration Here"></textarea>
                                    <span class="text-danger" *ngIf="

                                        (receiptFormControl.narration.touched ||
                                            submitted) &&
                                        receiptFormControl.narration.errors
                                            ?.required
                                    ">
                                        Please enter your Narration!
                                    </span>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div *ngIf="paymentMethod === 'cheque'" nz-col [nzSpan]="12">
                            <nz-form-item>
                                <nz-form-label [nzSpan]="8" nzFor="cheqNumber">Cheque Number</nz-form-label>
                                <nz-form-control [nzSpan]="16">
                                    <input nz-input formControlName="cheqNumber" name="cheqNumber" type="text"
                                        id="cheqNumber" nzRequired placeholder="Cheque Number" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </form>
            </div>
            <div nz-row nzGutter="0" style="margin-left: 20px;" *ngIf="selectedPlan === 'plan'">
                <form nz-form [nzLayout]="'inline'" [formGroup]="paymentPlanForm">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="12" nzFor="numberOfInstallments">Number Of Installments
                        </nz-form-label>
                        <nz-form-control [nzSpan]="12" nzErrorTip="Please input your username!">
                            <input id="numberOfInstallments" type="number" nz-input
                                formControlName="numberOfInstallments" />
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label [nzSm]="12" [nzXs]="24" nzRequired>Initial Installment Date
                        </nz-form-label>
                        <nz-form-control [nzSm]="12" [nzXs]="24">
                            <nz-date-picker formControlName="startDate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="12" nzFor="initialInstallmentAmount">Initial Installment Amount
                        </nz-form-label>
                        <nz-form-control [nzSpan]="12" nzErrorTip="Please input your username!">
                            <input id="initialInstallmentAmountt" type="number" nz-input
                                formControlName="initialInstallmentAmount" />
                        </nz-form-control>
                    </nz-form-item>
                </form>
            </div>
        </ng-template>

        <ng-template #modalFooter>
            <button nz-button nzType="default" (click)="handleReceiptCancel()">
                Cancel
            </button>
            <button *ngIf="selectedPlan === 'plan'" nz-button nzType="primary" (click)="handleReceiptOk()"
                [nzLoading]="isConfirmReceiptLoading">
                Submit
            </button>
            <button *ngIf="selectedPlan === 'fully'" nz-button nzType="primary" (click)="generateDocuments()"
                [nzLoading]="isConfirmReceiptLoading">
                Submit
            </button>
        </ng-template>
    </nz-modal>
</nz-spin>